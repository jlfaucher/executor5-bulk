#!/usr/bin/env rexx
/*
  SVN Revision: $Rev$
  Change Date:  $Date$
*/
/*----------------------------------------------------------------------------*/
/*                                                                            */
/* Copyright (c) 2007-2018 Rexx Language Association. All rights reserved.    */
/*                                                                            */
/* This program and the accompanying materials are made available under       */
/* the terms of the Common Public License v1.0 which accompanies this         */
/* distribution. A copy is also available at the following address:           */
/* http://www.oorexx.org/license.html                                         */
/*                                                                            */
/* Redistribution and use in source and binary forms, with or                 */
/* without modification, are permitted provided that the following            */
/* conditions are met:                                                        */
/*                                                                            */
/* Redistributions of source code must retain the above copyright             */
/* notice, this list of conditions and the following disclaimer.              */
/* Redistributions in binary form must reproduce the above copyright          */
/* notice, this list of conditions and the following disclaimer in            */
/* the documentation and/or other materials provided with the distribution.   */
/*                                                                            */
/* Neither the name of Rexx Language Association nor the names                */
/* of its contributors may be used to endorse or promote products             */
/* derived from this software without specific prior written permission.      */
/*                                                                            */
/* THIS SOFTWARE IS PROVIDED BY THE COPYright HOLDERS AND CONTRIBUTORS        */
/* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT          */
/* LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS          */
/* FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYright   */
/* OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,      */
/* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED   */
/* TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,        */
/* OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY     */
/* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING    */
/* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS         */
/* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.               */
/*                                                                            */
/*----------------------------------------------------------------------------*/
  parse source . . s
  group = .TestGroup~new(s)
  group~add(.SOURCELINE.testGroup)

  if group~isAutomatedTest then return group

  testResult = group~suite~execute~~print
return testResult

::requires 'ooTest.frm'
::requires "FileUtils.cls"

-- class named exactly like file
::class "SOURCELINE.testGroup" subclass ooTestCase public

::method 'test001'
    self~expectSyntax(40.14)
    xre = sourceLine(0)

::method 'test002'
    self~expectSyntax(40.12)
    xre = sourceLine("")

::method 'test003'
    self~expectSyntax(40.14)
    xre = sourceLine(-1)

::method 'test004'
    self~assertSame("::method 'test003'", sourceLine(65))

::method 'test005'
    self~assertSame("::method 'test004'", sourceLine('105'~d2x))

::method 'test006'
    self~assertSame("::method 'test005'", sourceLine(80-8))

::method 'test007'
    self~assertSame("::method 'test002'", sourceLine(.61E+2))

::method 'test008'
    self~assertSame("::method 'test007'", sourceLine(000000000078))

::method 'test009'
    v127 = 63
    self~assertSame("    xre = sourceLine("""")", sourceLine(v127))

::method 'test_line_one'
    -- The intent of this test is to assert that sourceline(1) returns the
    -- correct text, that there is not an "off by one" error.  Because the
    -- handling of a hashbang on the first line is not consistent for all
    -- operating systems, we write out out own external function and test
    -- sourceline(1) in that file.
    fileSrc = .array~new
    fileSrc[1]  = "/* This is a temporary ooRexx program */"
    fileSrc[2]  = ""
    fileSrc[3]  = "line1 = sourceline(1)"
    fileSrc[4]  = "return line1"

    fileName = .ooRexxUnit.dir || .ooRexxUnit.directory.separator || "test_line_one_temp"
    fileName = createFile(fileSrc, fileName)
    self~assertTrue(fileName <> "", "Source file must be created")
    self~assertTrue(SysIsFile(fileName), "Source file must exist")

    line1 = 'test_line_one_temp'()
    j = deleteFile(fileName)

    self~assertSame(fileSrc[1], line1, 'sourceline(1) must equal first line')

::method 'test_line_two'
   self~assertEquals("/*", sourceline(2), "sourceline(2) must equal second line")

::method 'test_last_line'
    lastLine = "/* End of file. Don't remove this marker.  Don't add lines after this line. */"
    self~assertSame(lastLine, sourceLine(137))

::method 'test_negative_number'
    self~expectSyntax(40.14)
    src = sourceLine(-25000)

::method 'test_non_integer_number'
    self~expectSyntax(40.12)
    src = sourceLine(15.450)

::method 'test_too_large_a_number'
    self~expectSyntax(40.34)
    src = sourceLine(15000)

::method 'test_too_large_by_one'
    self~expectSyntax(40.34)
    src = sourceLine(203)

::method "test_sourceline_with_no_args"
    self~assertTrue(sourceline()~datatype("N"), "sourceline() datatype must be a number")
    self~assertSame(137, sourceline(), "sourceline() must return correct count of lines")

/* End of file. Don't remove this marker.  Don't add lines after this line. */
