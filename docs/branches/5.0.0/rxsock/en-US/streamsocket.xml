<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "rxsock.ent">
%BOOK_ENTITIES;
]>
<!--#########################################################################
    #
    # Description: Open Object Rexx: RxSock TCP/IP Socket Functions Reference
    #
    # Copyright (c) 2005-2022, Rexx Language Association. All rights reserved.
    # Portions Copyright (c) 2004, IBM Corporation. All rights reserved.
    #
    # This program and the accompanying materials are made available under
    # the terms of the Common Public License v1.0 which accompanies this
    # distribution. A copy is also available at the following address:
    # http://www.oorexx.org/license.html
    #
    # Redistribution and use in source and binary forms, with or
    # without modification, are permitted provided that the following
    # conditions are met:
    #
    # Redistributions of source code must retain the above copyright
    # notice, this list of conditions and the following disclaimer.
    # Redistributions in binary form must reproduce the above copyright
    # notice, this list of conditions and the following disclaimer in
    # the documentation and/or other materials provided with the distribution.
    #
    # Neither the name of Rexx Language Association nor the names
    # of its contributors may be used to endorse or promote products
    # derived from this software without specific prior written permission.
    #
    # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    # "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
    # FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    # OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    # SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    # TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    # OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
    # OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
    # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    #
    #########################################################################
-->
<chapter><title>StreamSocket Class Reference</title>
<indexterm><primary>class, StreamSocket</primary></indexterm>
<indexterm><primary>StreamSocket class</primary></indexterm>
<para>The following sections describe the <classname>StreamSocket</classname> class supplied with ooRexx.
This class encapsulates the rxsock external functions into a class that
treats the socket as a standard ooRexx input/output stream. It improves
error checking and reduces the amount of code needed in an average rxsock
program.</para>

<section><title>Installation</title>
<indexterm><primary>installation, streamsocket class</primary></indexterm>
<indexterm><primary>streamsocket class installation</primary></indexterm>
<para>The StreamSocket class package is contained in the file streamsocket.cls. This file
must be placed in a directory listed in your PATH. To get access to the class
and methods in the StreamSocket class, include the following statement in your Rexx
program:
<programlisting>
::requires 'streamsocket.cls'
</programlisting></para>
</section>

<section id="clsStreamSocket"><title>The StreamSocket Class</title>
<indexterm><primary>StreamSocket class</primary></indexterm>
<indexterm><primary>class</primary>
<secondary>StreamSocket class</secondary></indexterm>

<para>A <classname>StreamSocket</classname> object allows external communication from
Rexx to a socket.</para>
<para>The <classname>StreamSocket</classname> class is a subclass of the
<classname>InputOutputStream</classname> class.</para>

<!-- modified: renamed init() to new() -->
<!-- $GENERATED-20160822-START rexxrefClassTable(StreamSocket) -->
<table id="ooRexxStreamSocketClass" frame="all" pgwide="1">
<title>StreamSocket Class</title>
<tgroup cols="1">
<tbody>
 <row><entry align="center"><emphasis role="bold">Object</emphasis></entry>
 </row>
<!-- should we link to rexxref here?
 <row><entry>Methods inherited from the <xref linkend="clsObject" xrefstyle="template:Object class"/></entry>
 </row>
-->
 <row><entry align="center"><emphasis role="bold">+ OutputStream (Mixin Class)</emphasis></entry>
 </row>
 <row><entry>
  Methods inherited from the <classname>OutputStream</classname> class
  <para>
  <simplelist columns="3">
   <member>arrayOut</member>
   <member>charIn</member>
   <member>charOut</member>
   <member>chars</member>
   <member>close</member>
   <member>lineIn</member>
   <member>lineOut</member>
   <member>lines</member>
   <member>open</member>
   <member>position</member>
  </simplelist>
  </para>
 </entry></row>
 <row><entry align="center"><emphasis role="bold">+ InputStream (Mixin Class)</emphasis></entry>
 </row>
 <row><entry>
  Methods inherited from the <classname>InputStream</classname> class
  <para>
  <simplelist columns="3">
   <member>arrayIn</member>
   <member>charIn</member>
   <member>charOut</member>
   <member>chars</member>
   <member>close</member>
   <member>lineIn</member>
   <member>lineOut</member>
   <member>lines</member>
   <member>open</member>
   <member>position</member>
  </simplelist>
  </para>
 </entry></row>
 <row><entry align="center"><emphasis role="bold">+ InputOutputStream (Mixin Class)</emphasis></entry>
 </row>
 <row><entry>
  Methods inherited from the <classname>InputOutputStream</classname> class
  <para>
   (no class or instance methods)
  </para>
 </entry></row>
 <row><entry align="center"><emphasis role="bold">StreamSocket</emphasis></entry>
 </row>
 <row><entry>
  <simplelist>
   <member><xref linkend="mthStreamSocketNew" xrefstyle="select:title"/></member>
  </simplelist>
  <simplelist columns="3">
   <member><xref linkend="mthStreamSocketArrayIn" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketArrayOut" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketCharIn" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketCharOut" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketChars" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketClose" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketDescription" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketLineIn" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketLineOut" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketLines" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketOpen" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketPosition" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketSay" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketState" xrefstyle="select:title"/></member>
   <member><xref linkend="mthStreamSocketString" xrefstyle="select:title"/></member>
  </simplelist>
 </entry></row>
</tbody>
</tgroup>
</table>
<!-- $GENERATED-20160822-END rexxrefClassTable(StreamSocket) -->

<section id="mthStreamSocketNew"><title>new (Inherited Class Method)</title>
<indexterm><primary>new method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>new method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_new.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Initializes a stream object for the
<emphasis role="italic">host</emphasis> and
<emphasis role="italic">port</emphasis>, but does not open the stream.
Returns the new stream object.</para>
<variablelist>
<varlistentry><term>host</term>
<listitem><para>The host name or TCP/IP address of an Internet host.
</para></listitem></varlistentry>
<varlistentry><term>port</term>
<listitem><para>The port number of the host.
</para></listitem></varlistentry>
<varlistentry><term>bufsize</term>
<listitem><para>(optional) The buffersize to use for read operations. The default size is 4096.
</para></listitem></varlistentry>
</variablelist>
</section>

<section id="mthStreamSocketArrayIn"><title>arrayIn</title>
<indexterm><primary>arrayIn method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>arrayIn method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<para>This method is invalid for this class and will raise an error if invoked.</para>
</section>

<section id="mthStreamSocketArrayOut"><title>arrayOut</title>
<indexterm><primary>arrayOut method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>arrayOut method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<para>This method is invalid for this class and will raise an error if invoked.</para>
</section>

<section id="mthStreamSocketCharIn"><title>charIn</title>
<indexterm><primary>charIn method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>charIn method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_charin.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns a string of up to <emphasis role="italic">length</emphasis>
characters from the input stream. If you omit
<emphasis role="italic">length</emphasis>, it defaults to
<computeroutput>1</computeroutput>. If you specify
<emphasis role="italic">start</emphasis>, it will be ignored since sockets are considered
not to be persistent streams.
If the stream is not already open, the stream attempts to open for reading and writing. If that
fails, the stream opens for input only.
</para>
</section>

<section id="mthStreamSocketCharOut"><title>charOut</title>
<indexterm><primary>charOut method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>charOut method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_charout.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns the count of characters remaining after trying to write
<emphasis role="italic">string</emphasis> to the output stream.</para>
<para>The <emphasis role="italic">string</emphasis> can be the null string.
In this case, <methodname>charOut</methodname> writes
no characters to the stream and returns <computeroutput>0</computeroutput>.
If you omit <emphasis role="italic">string</emphasis>,
<methodname>charOut</methodname> writes no
characters to the stream and returns <computeroutput>0</computeroutput>.</para>
<para>If you specify <emphasis role="italic">start</emphasis> it will be ignored since
socket streams are not considered persistent.
</para>
</section>

<section id="mthStreamSocketChars"><title>chars</title>
<indexterm><primary>chars method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>chars method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_chars.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns <computeroutput>1</computeroutput> if the stream is open.
Otherwise returns<computeroutput>0</computeroutput>.
</para>
</section>

<section id="mthStreamSocketClose"><title>close</title>
<indexterm><primary>close method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>close method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_close.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Closes the stream.
<methodname>close</methodname> returns
<computeroutput>READY:</computeroutput> if closing the stream is successful,
or an appropriate error message.
If you have tried to close an unopened socket, then the
<methodname>close</methodname> method returns
a null string (&quot;&quot;).</para>
</section>

<section id="mthStreamSocketDescription"><title>description</title>
<indexterm><primary>description method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>description method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_description.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns any descriptive string associated with the
current state of the stream or the Nil object if no descriptive string is
available. The <methodname>description</methodname>
method is identical with the <methodname>state</methodname> method except
that the string that <methodname>description</methodname>
returns is followed by a colon and, if
available, additional information about ERROR or NOTREADY states. (The
<xref linkend="mthStreamSocketState" xrefstyle="select:title" /> method describes these states.)</para>
</section>

<section id="mthStreamSocketLineIn"><title>lineIn</title>
<indexterm><primary>lineIn method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>lineIn method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_linein.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns the next <emphasis role="italic">count</emphasis> lines. The
count must be <computeroutput>0</computeroutput> or
<computeroutput>1</computeroutput>.
If you omit <emphasis role="italic">count</emphasis>, it defaults to
<computeroutput>1</computeroutput>. A <emphasis role="italic">line</emphasis>
number may be given but it will be ignored since sockets are not considered to be
a persistent stream.
If the stream is not already
open, the it tries to open the stream for reading and writing.
</para>
</section>

<section id="mthStreamSocketLineOut"><title>lineOut</title>
<indexterm><primary>lineOut method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>lineOut method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_lineout.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns <computeroutput>0</computeroutput> if successful in writing
<emphasis role="italic">string</emphasis> to the output stream
or <computeroutput>1</computeroutput> if
an error occurs while writing the line.
If you specify
<emphasis role="italic">line</emphasis> it will be ignored since a socket is not considered
to be a persistent stream.
</para>
</section>

<section id="mthStreamSocketLines"><title>lines</title>
<indexterm><primary>lines method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>lines method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_lines.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns <computeroutput>1</computeroutput> if the stream is open.
Otherwise returns<computeroutput>0</computeroutput>.
</para>
</section>

<section id="mthStreamSocketOpen"><title>open</title>
<indexterm><primary>open method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>open method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_open.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Opens the stream for input and output and returns
<computeroutput>READY:</computeroutput>. If the method is unsuccessful, it
returns an error message string in the same form that the
<methodname>description</methodname> method uses.</para>
<para>For most error conditions, the additional information is in the form of
a numeric return code. This return code is the value of
<computeroutput>ERRNO</computeroutput>,
which is set whenever one of the file system primitives returns with a
<computeroutput>-1</computeroutput>.</para>
</section>

<section id="mthStreamSocketPosition"><title>position</title>
<indexterm><primary>position method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>position method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_position.svg" scale="55" />
</imageobject>
</mediaobject>

<para>This method is invalid for this class and will raise an error if invoked.</para>
</section>

<section id="mthStreamSocketSay"><title>say</title>
<indexterm><primary>say method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>say method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_say.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns <computeroutput>0</computeroutput> if successful in writing
<emphasis role="italic">string</emphasis> to the output stream
or <computeroutput>1</computeroutput> if
an error occurs while writing the line.</para>
</section>

<section id="mthStreamSocketState"><title>state</title>
<indexterm><primary>state method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>state method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_state.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns a string indicating the current stream state.
</para>
<para>The returned strings are as follows: </para>
<variablelist>
<varlistentry><term>ERROR</term>
<listitem><para>The stream has been subject to an erroneous operation
(possibly during input or output.
You might be able to obtain additional information about the error with the
<methodname>description</methodname> method.
</para></listitem></varlistentry>
<varlistentry><term>NOTREADY</term>
<listitem><para>The stream is known to be in such a state that the usual input
or output operations attempted upon would raise the NOTREADY condition.
</para></listitem></varlistentry>
<varlistentry><term>READY</term>
<listitem><para>The stream is known to be in such a state that the usual input
or output operations might be attempted. This is the usual state for a stream,
although it does not guarantee that any particular operation will succeed.
</para></listitem></varlistentry>
<varlistentry><term>UNKNOWN</term>
<listitem><para>The state of the stream is unknown. This generally means that
the stream is closed or has not yet been opened.
</para></listitem></varlistentry>
</variablelist>
</section>

<section id="mthStreamSocketString"><title>string</title>
<indexterm><primary>string method</primary>
<secondary>of StreamSocket class</secondary></indexterm>
<indexterm><primary>method</primary>
<secondary>string method</secondary>
<tertiary>of StreamSocket class</tertiary></indexterm>

<mediaobject>
<imageobject>
<imagedata fileref="images/methods/streamsocket_string.svg" scale="55" />
</imageobject>
</mediaobject>

<para>Returns a string that indicates the name of the object the stream
represents i.e. the <computeroutput>hostname:port</computeroutput>.
</para>
</section>
</section>
</chapter>
