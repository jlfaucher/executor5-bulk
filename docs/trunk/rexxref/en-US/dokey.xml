<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE appendix PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "rexxref.ent">
%BOOK_ENTITIES;
]>
<!--#########################################################################
    #
    # Description: Open Object Rexx: Reference XML File
    #
    # Copyright (c) 2005-2014, Rexx Language Association. All rights reserved.
    # Portions Copyright (c) 2004, IBM Corporation. All rights reserved.
    #
    # This program and the accompanying materials are made available under
    # the terms of the Common Public License v1.0 which accompanies this
    # distribution. A copy is also available at the following address:
    # http://www.oorexx.org/license.html
    #
    # Redistribution and use in source and binary forms, with or
    # without modification, are permitted provided that the following
    # conditions are met:
    #
    # Redistributions of source code must retain the above copyright
    # notice, this list of conditions and the following disclaimer.
    # Redistributions in binary form must reproduce the above copyright
    # notice, this list of conditions and the following disclaimer in
    # the documentation and/or other materials provided with the distribution.
    #
    # Neither the name of Rexx Language Association nor the names
    # of its contributors may be used to endorse or promote products
    # derived from this software without specific prior written permission.
    #
    # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    # "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
    # FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    # OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    # SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    # TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    # OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
    # OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
    # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    #
    #########################################################################
-->
<appendix id="dokey"><title>Using DO and LOOP</title>
<indexterm><primary>DO instruction</primary>
<secondary>example</secondary></indexterm>
<indexterm><primary>examples</primary>
<secondary>DO instruction</secondary></indexterm>
<indexterm><primary>LOOP instruction</primary>
<secondary>example</secondary></indexterm>
<indexterm><primary>examples</primary>
<secondary>LOOP instruction</secondary></indexterm>
<para>This appendix provides you with additional information about the DO
and LOOP keyword instructions.</para>

<section id="simpdo"><title>Simple DO Group</title>
<indexterm><primary>group, DO</primary></indexterm>
<indexterm><primary>repetitive loops</primary>
<secondary>simple DO group</secondary></indexterm>
<para>If you specify neither <emphasis role="italic">repetitor</emphasis> nor
<emphasis role="italic">conditional</emphasis>, the
DO construct only groups a number of instructions together.  They are processed
once. For example:</para>
<example id="ex.do-1">
<title>Simple DO block</title>
<programlisting>
/* The two instructions between DO and END are both  */
/* processed if A has the value "3".                 */
If a=3 then Do
   a=a+2
   Say "Smile!"
End
</programlisting>
</example>
</section>

<section id="doloop"><title>Repetitive Loops</title>
<indexterm><primary>loops</primary>
<secondary>repetitive</secondary></indexterm>
<indexterm><primary>simple</primary>
<secondary>repetitive loops</secondary></indexterm>
<para>If a DO or LOOP instruction has a repetitor phrase, a conditional phrase, or both,
the group of instructions forms a repetitive loop.
The instructions are processed according to the repetitor phrase, optionally
modified by the conditional phrase. (See
<xref linkend="whileuntil" />.)</para>

<section id="simprlp"><title>Simple Repetitive Loops</title>
<indexterm><primary>FOREVER subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>FOREVER subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<para>A simple repetitive loop is a repetitive
loop in which the repetitor phrase is an expression that evaluates to a
count of the iterations.</para>
<para>If <emphasis role="italic">repetitor</emphasis> is omitted but there is a
<emphasis role="italic">conditional</emphasis> or
if the <emphasis role="italic">repetitor</emphasis>
is FOREVER, the group of instructions is processed
until the condition is satisfied or a Rexx instruction ends the loop (for
example, LEAVE).</para>
<para>In the simple form of a repetitive loop,
<emphasis role="italic">exprr</emphasis> is evaluated immediately
(and must result in a positive whole number or zero), and the loop is then
processed that many times.</para>
<example id="ex.loop-1">
<title>Simple LOOP block</title>
<programlisting>
/* This displays "Hello" five times */
Loop 5
say "Hello"
end
</programlisting>
</example>
<para>Note that, similar to the distinction between a command and an assignment,
if the first token of <emphasis role="italic">exprr</emphasis>
is a symbol and the second token is (or
starts with) <computeroutput>=</computeroutput>, the controlled form of
<emphasis role="italic">repetitor</emphasis> is expected.</para>
</section>

<section id="contrlp"><title>Controlled Repetitive Loops</title>
<indexterm><primary>infinite loops</primary></indexterm>
<indexterm><primary>controlled loops</primary></indexterm>
<indexterm><primary>TO subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>BY subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>TO subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>BY subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<para>The controlled form specifies <emphasis role="italic">control1</emphasis>,
a <emphasis role="italic">control variable</emphasis>
<indexterm><primary>control variable</primary></indexterm>
<indexterm><primary>END clause</primary>
<secondary>specifying control variable</secondary></indexterm>
<indexterm><primary>repetitive loops</primary>
<secondary>controlled repetitive loops</secondary></indexterm>
<indexterm><primary>variable</primary>
<secondary>controlling loops</secondary></indexterm>
that is assigned an initial value (the result of
<emphasis role="italic">expri</emphasis>, formatted as though
<computeroutput>0</computeroutput> had been added) before the first
execution of the instruction list. The variable is then stepped by adding
the result of <emphasis role="italic">exprb</emphasis> before the second and
subsequent times that the instruction list is processed.</para>
<para>The instruction list is processed repeatedly as long as the end condition
(determined by the result of <emphasis role="italic">exprt</emphasis>)
is not met. If <emphasis role="italic">exprb</emphasis>
is positive or <computeroutput>0</computeroutput>, the loop is ended when
<emphasis role="italic">control1</emphasis> is greater
than <emphasis role="italic">exprt</emphasis>. If negative, the loop is ended
when <emphasis role="italic">control1</emphasis>
is less than <emphasis role="italic">exprt</emphasis>.</para>
<para>The <emphasis role="italic">expri</emphasis>,
<emphasis role="italic">exprt</emphasis>, and
<emphasis role="italic">exprb</emphasis> options must result in numbers.
They are evaluated only once, before the loop begins and before the control
variable is set to its initial value. The default value for
<emphasis role="italic">exprb</emphasis> is <computeroutput>1</computeroutput>.
If <emphasis role="italic">exprt</emphasis> is omitted, the loop runs
infinitely unless some other condition stops it.</para>
<example id="ex.loop-2">
<title>Simple LOOP block with conditions</title>
<programlisting>
Loop I=3 to -2 by -1      /* Displays:   */
  say i                   /*      3      */
end                       /*      2      */
                          /*      1      */
                          /*      0      */
                          /*     -1      */
                          /*     -2      */
</programlisting>
</example>
<para>The numbers do not have to be whole numbers:</para>
<example id="ex.loop-3">
<title>Simple LOOP block with conditions</title>
<programlisting>
I=0.3                     /* Displays:   */
Do Y=I to I+4 by 0.7      /*     0.3     */
  say Y                   /*     1.0     */
end                       /*     1.7     */
                          /*     2.4     */
                          /*     3.1     */
                          /*     3.8     */
</programlisting>
</example>
<para>The control variable can be altered within the loop, and this can affect
the iteration of the loop. Altering the value of the control variable is not
considered good programming practice, though it can be appropriate in certain
circumstances.</para>
<para>Note that the end condition is tested at the start of each iteration (and
after the control variable is stepped, on the second and subsequent iterations).
Therefore, if the end condition is met immediately, the group of instructions
can be skipped entirely. Note also that the control variable is referred to
by name. If, for example, the compound name
<computeroutput>A.I</computeroutput> is used for the
control variable, altering <computeroutput>I</computeroutput>
within the loop causes a change in the control variable.</para>
<para>The execution of a controlled loop can be limited further by a FOR phrase.
In this case, you must specify <emphasis role="italic">exprf</emphasis>,
and it must evaluate to a positive
whole number or zero. This acts like the repetition count in a simple repetitive
loop, and sets a limit to the number of iterations around the loop if no other
condition stops it. Like the TO and BY expressions, it is evaluated only once&mdash;when
the instruction is first processed and before the control variable receives
its initial value. Like the TO condition, the FOR condition is checked at
the start of each iteration.</para>
<example id="ex.loop-4">
<title>Simple LOOP block with limits</title>
<programlisting>
Loop Y=0.3 to 4.3 by 0.7 for 3  /* Displays:    */
  say Y                         /*     0.3      */
end                             /*     1.0      */
                                /*     1.7      */
</programlisting>
</example>
<para>In a controlled loop, the
<emphasis role="italic">control1</emphasis> name describing the control
variable can be specified on the END clause. This
<emphasis role="italic">name</emphasis> must match
<emphasis role="italic">control1</emphasis> in the DO or LOOP clause in all respects
except the case (note that
no substitution for compound variables is carried out). Otherwise, a syntax
error results. This enables the nesting of loops to be checked automatically,
with minimal overhead.</para>
<example id="ex.loop-5">
<title>Simple LOOP block with limits</title>
<programlisting>
Loop K=1 to 10
...
...
End k  /* Checks that this is the END for K loop */
</programlisting>
</example>

<note><title>Note</title>
<para>The NUMERIC settings can affect the successive values of the
control variable because Rexx arithmetic rules apply to the computation of
stepping the control variable.</para>
</note>
</section>
</section>

<section id="reploo"><title>Repetitive Loops over Collections</title>
<indexterm><primary>loops</primary>
<secondary>over collections</secondary></indexterm>
<indexterm><primary>OVER subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>OVER subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<para>A collection loop specifies a control variable,
<emphasis role="italic">control2</emphasis>, which
receives a different value on each repetition of the loop. (For more information
on <emphasis role="italic">control2</emphasis>, see
<xref linkend="keyDo" />.) These different values are
taken from successive values of <emphasis role="italic">collection</emphasis>.
The <emphasis role="italic">collection</emphasis>
is any expression that evaluates to an object that provides a <methodname>makeArray</methodname> method,
including stem variables. The collection returned determines the set of values
and their order.
Array, List, and Queue items return an array with the items in the appropriate order,
as do Streams. Tables, Stems, Directories, etc. are not ordered so the items
get placed in the array in no particular order.</para>
<para>If the collection is a stem variable, the values are the tail names that
have been explicitly assigned to the given stem. The order of the tail names
is unspecified, and a program should not rely on any order.</para>
<para>For other collection objects, the <methodname>makeArray</methodname> method of the specific collection
class determines the values assigned to the control variable.</para>
<para>All values for the loop iteration are obtained at the beginning of the
loop. Therefore, changes to the target collection object do not affect the
loop iteration. For example, using DROP to change the set of tails associated
with a stem or using a new value as a tail does not change the number of loop
iterations or the values over which the loop iterates.</para>
<para>As with controlled repetition, you can specify the symbol that describes
the control variable on the END clause. The control variable is referenced
by name, and you can change it within the loop (although this would not usually
be useful). You can also specify the control variable name on an ITERATE or
LEAVE instruction.</para>
<example id="ex.loop-6">
<title>Simple LOOP block over a collection</title>
<programlisting>
Astem.=0
Astem.3="CCC"
Astem.24="XXX"
loop k over Astem.
   say k Astem.k
end k
</programlisting>
</example>
<para>This example can produce: </para>
<programlisting>
3 CCC
24 XXX
</programlisting>
<para>or: </para>
<programlisting>
24 XXX
3 CCC
</programlisting>
<para>See <xref linkend="do2" /> for a diagram.</para>
</section>

<section id="reploopSupplier" revisionflag="added"><title>*NEW* Repetitive Loops over Suppliers</title>
<indexterm><primary>loops</primary><secondary>over suppliers</secondary></indexterm>
<indexterm><primary>WITH subkeyword</primary><secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>WITH subkeyword</primary><secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>INDEX subkeyword</primary><secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>INDEX subkeyword</primary><secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>ITEM subkeyword</primary><secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>ITEM subkeyword</primary><secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>OVER subkeyword</primary><secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>OVER subkeyword</primary><secondary>in a LOOP instruction</secondary></indexterm>
<para>A supplier loop specifies one or two control variables,
<emphasis role="italic">index</emphasis>, and
<emphasis role="italic">item</emphasis>, which
receive a different value on each repetition of the loop. (For more information
on <emphasis role="italic">index</emphasis> and
<emphasis role="italic">item</emphasis>, see
<xref linkend="keyDo" />.) These different values are
taken from successive values of <emphasis role="italic">supplier</emphasis>.
The <emphasis role="italic">supplier</emphasis>
is any expression that evaluates to an object that provides a SUPPLIER method.
The supplier returned determines the set of values
and their order.
</para>
<para>All values for the loop iteration are obtained at the beginning of the
loop. Therefore, changes to the target object do not affect the
loop iteration.</para>
<para>If you want to specify a <emphasis role="italic">name</emphasis>
on the END clause or on an ITERATE or LEAVE instruction, you have to
specify the LABEL keyword.</para>
<example id="ex.loop-supplier">
<title>LOOP WITH over a supplier</title>
<programlisting>loop with index name item method over .numericComparator~methods(.nil)
  say name method~isPrivate method~isProtected method~isGuarded
end
</programlisting>
</example>
<para>This example can produce:</para>
<programlisting>COMPARE 0 0 1
INIT 0 0 1
</programlisting>
</section>

<section id="whileuntil"><title>Conditional Phrases (WHILE and UNTIL)</title>
<indexterm><primary>conditional</primary>
<secondary>phrase</secondary></indexterm>
<indexterm><primary>FOREVER subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>WHILE subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>UNTIL subkeyword</primary>
<secondary>in a DO instruction</secondary></indexterm>
<indexterm><primary>FOREVER subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>WHILE subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<indexterm><primary>UNTIL subkeyword</primary>
<secondary>in a LOOP instruction</secondary></indexterm>
<para>A conditional phrase can
modify the iteration of a repetitive loop. It can cause the termination
of a loop. It can follow any of the forms of
<emphasis role="italic">repetitor</emphasis> (none, FOREVER,
simple, or controlled). If you specify WHILE or UNTIL,
<emphasis role="italic">exprw</emphasis> or
<emphasis role="italic">expru</emphasis>, respectively, is evaluated after
each loop using the latest values of all variables, and the loop is ended if
<emphasis role="italic">exprw</emphasis> evaluates to
<computeroutput>0</computeroutput> or
<emphasis role="italic">expru</emphasis> evaluates to
<computeroutput>1</computeroutput>.</para>
<para>For a WHILE loop, the condition is evaluated at the top of the group of
instructions.  For an UNTIL loop, the condition is evaluated at the bottom&mdash;before
the control variable has been stepped.</para>
<example id="ex.loop-7">
<title>Simple LOOP block with contitions</title>
<programlisting>
Loop I=1 to 10 by 2 until i>6
   say i
end
/* Displays: "1" "3" "5" "7" */
</programlisting>
</example>

<note><title>Note</title>
<para>Using the LEAVE or ITERATE
instructions can also modify the execution of repetitive loops.</para>
</note>
</section>
<section id="labelphrase"><title>LABEL Phrase</title>
<para>The LABEL phrase may be used to specify a <emphasis role="italic">name</emphasis> for
the DO or LOOP.  The can optionally be used for</para>
<itemizedlist>
<listitem><para>a LEAVE instruction to identify the block to be left</para></listitem>
<listitem><para>an ITERATE instruction to identify the loop to be iterated</para></listitem>
<listitem><para>the END clause of the block, for additional checking.</para></listitem>
</itemizedlist>
<example id="ex.loop-8">
<title>Simple LOOP block with label</title>
<programlisting>
Loop label outer I=1 to 10 by 2
   ...
   if i > 5 then do label inner
      ...
      if a = b then leave inner
      ...
      if c = b then iterate outer
   end inner
   ...
   say i
end outer
/* Displays: "1" "3" "5" "7" */
</programlisting>
</example>
<para>In this example, the LEAVE instruction will exit the inner DO block.  The ITERATE
instruction will iterate the out LOOP instruction.</para>
<para>If a LABEL phrase is used on a DO or LOOP, it overrides any name derived from any
control variable name.  That is, if label is used, the control variable cannot be used on a
LEAVE, ITERATE, or END instruction to identify the block.  Only the label name is valid.
</para>
</section>

<section id="loopmodel"><title>Conceptual Model of Loops</title>
<figure id="do2"><title>Concept of a Loop</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/doloopconcept.png" />
</imageobject>
</mediaobject>
</figure>
<indexterm><primary>loops</primary>
<secondary>execution model</secondary></indexterm>

<figure><title>Concept of Repetitive Loop over Collection</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/doloopcollection.png" />
</imageobject>
</mediaobject>
</figure>
<indexterm><primary>loops</primary>
<secondary>execution model</secondary></indexterm>

</section>

</appendix>
