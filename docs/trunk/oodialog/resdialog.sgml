<!--#########################################################################
    #
    # Description: Open Object Rexx: OODialog Reference SGML file.
    #
    # Copyright (c) 2005-2007, Rexx Language Association. All rights reserved.
    # Portions Copyright (c) 2004, IBM Corporation. All rights reserved.
    #
    # This program and the accompanying materials are made available under
    # the terms of the Common Public License v1.0 which accompanies this
    # distribution. A copy is also available at the following address:
    # http://www.oorexx.org/license.html
    #
    # Redistribution and use in source and binary forms, with or
    # without modification, are permitted provided that the following
    # conditions are met:
    #
    # Redistributions of source code must retain the above copyright
    # notice, this list of conditions and the following disclaimer.
    # Redistributions in binary form must reproduce the above copyright
    # notice, this list of conditions and the following disclaimer in
    # the documentation and/or other materials provided with the distribution.
    #
    # Neither the name of Rexx Language Association nor the names
    # of its contributors may be used to endorse or promote products
    # derived from this software without specific prior written permission.
    #
    # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    # "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
    # FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    # OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    # SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    # TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    # OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
    # OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
    # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    #
    # Author(s):
    #      W. David Ashley <dashley@us.ibm.com>
    #
    #########################################################################
-->
<chapter id="resourcedialogs"><title>Resource File Dialogs</title>
<indexterm><primary>Resource file dialogs</primary></indexterm>
<para>
  The resource definition for a dialog can either be constructed manually, (see the <link
  linkend="clsUserDialog">UserDialog</link> Class,) or the definition can be read from a file.  ooDialog
  provides two main dialog classes that read their dialog definitions from a file: the <link
  linkend="clsResDialog">ResDialog</link> class and the <link linkend="clsRcDialog">RcDialog</link>
  class.
</para>
<para>
  The <computeroutput>ResDialog</computeroutput> class uses a dialog definition from a binary file and a
  <computeroutput>RcDialog</computeroutput> class gets the definition from a resource script file.
  Resource script files are plain text files.  In general, both types of files are produced by resource
  editors which allow the user to visually design the dialog in a &quot;What You See Is What You
  Get&quot; manner.  Since resource definitions are standardized, resource editors that produce Windows
  compatible files can be used to define dialogs for use with ooDialog.
</para>

<section id="clsResDialog"><title>ResDialog Class</title>
<indexterm><primary>Resource file dialogs</primary>
<secondary>ResDialog class</secondary></indexterm>
<indexterm><primary>ResDialog class</primary></indexterm>
<para>
  The ResDialog class is designed to be used together with a binary (compiled) resource. Compiled
  resources can be attached a <emphasis role="italic">module</emphasis>, which in Windows is a binary
  executable file. (That is, a file with the extension .exe or .dll).  It is possible to create a DLL
  that has no executable code and attach compiled resources to it.  The common term for this type of DLL
  is a <emphasis role="italic">resource only</emphasis> DLL.  A resource only DLL is the type of module
  that makes the most sense to use with the ResDialog class.  However, there is no reason why any DLL,
  that has the compiled resource attached to it, could not be used.
</para>
<variablelist>
<varlistentry><term>Requires:</term>
<listitem>
<para>
  <computeroutput>ResDlg.cls</computeroutput> is the source file of this class.
  <programlisting>
  <![CDATA[
  ::requires "oodialog.cls"
  ]]>
  </programlisting>
</para>
</listitem></varlistentry>
<varlistentry><term>Subclass:</term>
<listitem>
<para>
  The ResDialog class is a subclass of <link linkend="clsBaseDialog">BaseDialog</link> and therefore
  inherits all the methods of that class.
</para>
</listitem></varlistentry>
</variablelist>

<section id="mthNewClsResDialog"><title>new (Class method)</title>
<indexterm><primary>new</primary>
<secondary>ResDialog class</secondary></indexterm>
<programlisting>
<![CDATA[
>>--new(--module--,--id--+-------------+--+----------+--)------------><
                         +-,--DlgData.-+  +-,--hFile-+


]]>
</programlisting>

<para>
  Instantiates a new ResDialog object.  The dialog template for the object is taken from the specified
  module, which normally is a resource only DLL.
</para>
<variablelist>
  <varlistentry><term><emphasis role="bold">Arguments:</emphasis></term>
  <listitem>
  <para>
    The arguments when creating a new dialog instance of this class are:
    <variablelist>
      <varlistentry><term>module</term>
      <listitem>
      <para>
        The file name of the DLL where the resource is located.
      </para>
      </listitem></varlistentry>
      <varlistentry><term>id</term>
      <listitem>
      <para>
        The ID of the resource.  This is an unique number, or <link linkend="symbolicid">sybmbolic
        ID</link> resolving to the unique number.  This number is assigned to the dialog template
        resource when it was created.
      </para>
      </listitem></varlistentry>
      <varlistentry><term>DlgData.</term>
      <listitem>
      <para>
        A stem variable (don't forget the trailing period) that contains initialization data.
      </para>
      </listitem></varlistentry>
      <varlistentry><term>hFile</term>
      <listitem>
      <para>
        The file name of a <link linkend="headerfile">header file</link> containing symbolic ID defines
        for resources.
      </para>
      </listitem></varlistentry>
    </variablelist>
  </para>
  </listitem></varlistentry>
  <varlistentry><term><emphasis role="bold">Example:</emphasis></term>
  <listitem>
  <para>
    This sample code creates a new dialog object from the ResDialog class. It uses dialog resource 100 in
    the <computeroutput>MYDLG.DLL</computeroutput> file. The dialog is initialized with the values of the
    MyDlgData. stem variable.
    <programlisting>
    <![CDATA[
    MyDlgData.101="1"
    MyDlgData.102="Please enter your password."
    MyDlgData.103=""

    dlg = ResDialog~new("MYDLG.DLL", 100, MyDlgData.)
    if dlg~initCode <> 0 then do
      say 'The dialog could not be created'
      return .false
      /* Or some other error handling code. */
    end
      ...
    ]]>
    </programlisting>
  </para>
  <para>
    An additional <link linkend="basedialoginitexample">example</link> can be found under the
    <computeroutput>Init</computeroutput> method, in the BaseDialog section, that shows the use of the
    dialog data stem and header file arguments in more detail.
  </para>
  </listitem></varlistentry>
</variablelist>

<note><title>Note</title>
<para>
  For a <computeroutput>ResDialog</computeroutput> the <computeroutput>InitCode</computeroutput>
  attribute will be -1 after the dialog object is instantiated if the resource ID could not be
  resolved. For other cases where initialization failed the value will be some other non-zero value.
</para>
</note>
</section>

<section id="h001501"><title>StartIt</title>
<indexterm><primary>Startit</primary>
<secondary>ResDialog class</secondary></indexterm>
<programlisting>
<![CDATA[
>>-aResDialog~StartIt(--+------+--+-----------+--)-------------><
                        +-icon-+  +-,--modal--+


]]>
</programlisting>

<para>The StartIt method is intended for internal use only. It is used to create
the real Windows object based on the dialog template in the binary resource
file.  It is called by the <link linkend="h000048">Execute</link> or
<link linkend="h000057">ExecuteAsync</link> methods.</para>
<variablelist>
<varlistentry><term><emphasis role="bold">Internal Use:</emphasis></term>
<listitem><para>This method is intended for internal use.  It can be overridden,
although that is not recommended.
</para></listitem></varlistentry>
<varlistentry><term><emphasis role="bold">Arguments:</emphasis></term>
<listitem><para>There are two optional arguments:
<variablelist>
<varlistentry><term>icon</term>
<listitem><para>The resource ID of the icon to be used as the dialog icon.  When
this argument is omitted the default dialog icon is used.
</para></listitem></varlistentry>
<varlistentry><term>modal</term>
<listitem><para>If a modal or a modeless dialog is to be created.  A value of 0
signals a modal dialog should be created.  A value of 1, or the string
&quot;NOTMODAL&quot; case insignificant, signals a modeless dialog should be
created.  The default is 0.
</para></listitem></varlistentry>
</variablelist>
</para></listitem></varlistentry>
</variablelist>
</section>

<section id="rdsmm"><title>SetMenu</title>
<indexterm><primary>SetMenu</primary>
<secondary>ResDialog class</secondary></indexterm>
<programlisting>
<![CDATA[
>>-aResDialog~SetMenu(--resid--)-------------------------------><


]]>
</programlisting>

<para>The SetMenu method adds a menu resource, that is
stored in the same DLL, to the dialog. Note that the menu needs additional
space and therefore displaces the rest of the dialog items.</para>
<para>SetMenu can be called in the InitDialog method only. </para>
<variablelist>
<varlistentry><term><emphasis role="bold">Arguments:</emphasis></term>
<listitem><para>There is only one argument:
<variablelist>
<varlistentry><term>resid</term>
<listitem><para>ID of the menu resource stored in the same DLL as the dialog.
</para></listitem></varlistentry>
</variablelist>
</para></listitem></varlistentry>
</variablelist>
</section>
</section>

<section id="clsRcDialog"><title>RcDialog Class</title>
<indexterm><primary>Resource file dialogs</primary>
<secondary>RcDialog class</secondary></indexterm>
<indexterm><primary>RcDialog class</primary></indexterm>
<para>The <computeroutput>RcDialog</computeroutput> class gets its dialog
definition from a resource script file.  Resource script files are plain text
files usually produced by a resource editor.  The files generally have a file
extension of &quot;.rc&quot;, but an extension of &quot;.dlg&quot; is used by
some resource editors.</para>
<para>This class subclasses the <link linkend="clsUserDialog">UserDialog</link>
class and has available all the methods of that class.  <computeroutput>RcDialog
</computeroutput> is a convenience class that uses the <link linkend="h001613">
Load</link> method of the <computeroutput>UserDialog</computeroutput> to load
the dialog definition from the resource script file.  The programmer then does
not need to worry about the details of how and when to load the resource script.
There is a slight difference in instantiating the class, and the programmer does
not need to use the <link linkend="h001506">DefineDialog</link> method because
the dialog is defined in the resource script.  Other than that, the
<computeroutput>RcDialog</computeroutput> class is used in the same manner as
the <computeroutput>UserDialog</computeroutput> class.</para>
<note><title>Note</title><para>
Although the programmer does not need to use the
<computeroutput>Define</computeroutput> method, there is nothing preventing its
use.  The <computeroutput>Define</computeroutput> method could be used at
runtime to add additional dialog elements to those defined in the resource
script.
</para></note>
<variablelist>
<varlistentry><term>Requires:</term>
<listitem><para><computeroutput>RcDialog.cls</computeroutput> is the source file
for this class.
<programlisting>
<![CDATA[
::requires "oodialog.cls"
]]>
</programlisting>
</para></listitem></varlistentry>
<varlistentry><term>Subclass:</term>
<listitem><para>The <computeroutput>RcDialog</computeroutput> class is a
subclass of <computeroutput>UserDialog</computeroutput>.
</para></listitem></varlistentry>
</variablelist>

<section id="mthInitRcDialog"><title>Init</title>
<indexterm><primary>Init</primary>
<secondary>RcDialog class</secondary></indexterm>
<programlisting>
<![CDATA[
>>-aRcDialog~Init(--script--,--dlgID--+-------------+--+----------+--------->
                                      +-,--dlgData.-+  +-,--hFile-+

>--+------------------------------------------------------+--)-------------><
   +-,--+------------------------------+--+-------------+-+
        |    .--------------------.    |  +-,--expected-+
        |    V                    |    |
        +-"----+-CENTER---------+-+--"-+
               +-CONNECTBUTTONS-+
               +-CONNECTRADIOS--+
               +-CONNECTCHECKS--+

]]>
</programlisting>

<para>The Init method of the parent class,
<computeroutput>UserDialog</computeroutput>, has been overridden.</para>
<variablelist>
<varlistentry><term><emphasis role="bold">Arguments:</emphasis></term>
<listitem><para>The arguments when creating a new dialog instance of this class
are:
<variablelist>
<varlistentry><term>script</term>
<listitem><para>The name of the resource script file where the dialog is
defined.
</para></listitem></varlistentry>
<varlistentry><term>dlgID</term>
<listitem><para>The resource ID of the dialog.  This is the unique number, or
<link linkend="symbolicid">sybmbolic ID</link>, you assigned to the (dialog)
resource when creating it.
</para></listitem></varlistentry>
<varlistentry><term>dlgData.</term>
<listitem><para>A stem variable (don't forget the trailing period) that contains
initialization data.
</para></listitem></varlistentry>
<varlistentry><term>hFile</term>
<listitem><para>The file name of a <link linkend="headerfile">header file</link>
containing the symbolic ID defines for the resources used by the program.
</para></listitem></varlistentry>
<varlistentry><term>options</term>
<listitem><para>One or more of the keywords listed in the syntax diagram, separated
by blanks:
<variablelist>
<varlistentry><term>CENTER</term>
<listitem><para>The dialog is to be positioned in the center of the screen.
</para></listitem></varlistentry>
<varlistentry><term>CONNECTBUTTONS</term>
<listitem><para>For each push button a connection to an object method in the
<computeroutput>RcDialog</computeroutput> object is established automatically.
See <link linkend="h000114">ConnectButton</link> for a description of connecting
buttons to a method.  The name for the object method is created by ooDialog and
the programmer needs to define the object method.  The method name will be the
button text with all spaces, ampersands, and colons removed.
</para></listitem></varlistentry>
<varlistentry><term>CONNECTRADIOS</term>
<listitem><para>Similar to CONNECTBUTTONS, but this option will connect the
radio buttons to an object method.  For radio buttons, the created method name
will be the button text with all spaces, ampersands, and colons removed,
prefaced with &quot;ID&quot;.
</para></listitem></varlistentry>
<varlistentry><term>CONNECTCHECKS</term>
<listitem><para>Exactly the same as CONNECTRADIOS, for check box controls.  The
object method name is generated in the same way as it is for radio buttons.
</para></listitem></varlistentry>
</variablelist>
</para></listitem></varlistentry>
<varlistentry><term>expected</term>
<listitem><para>This is the maximum number of dialog elements the dialog object can
handle. See the <link linkend="h001545">Create</link> method for details.  The
default value for this argument is 200.
</para></listitem></varlistentry>
</variablelist>
</para></listitem></varlistentry>
<varlistentry><term><emphasis role="bold">Example:</emphasis></term>
<listitem><para>This example creates a new dialog object using the
<computeroutput>SimpleLB</computeroutput> class, which subclasses the
<computeroutput>RcDialog</computeroutput>. It uses the dialog defintion with
symbolic ID <computeroutput>IDD_DIALOG1</computeroutput> in the
<computeroutput>listBox.rc</computeroutput> resource script file.  The dialog is
initialized so that the &quot;Doctor&quot; item is selected in the list box with
symbolic ID of <computeroutput>IDC_LB</computeroutput> by using the
<computeroutput>dlgData.</computeroutput> stem variable.  The symbolic IDs for
this program are contained in the &quot;resource.h&quot; file.  When the user
closes the dialog, the <computeroutput>dlgData.IDC_LB</computeroutput> variable
will contain the text of the selected item in the list box.</para>

<programlisting>
<![CDATA[
/* Simple ListBox using a .rc file for the dialog definition */

  dlgData.IDC_LB = "Doctor"

  dlg = .SimpleLB~new("listBox.rc", IDD_DIALOG1, dlgData., "resource.h")
  if dlg~initCode = 0 then do
    dlg~Execute("SHOWTOP")
    dlg~Deinstall
  end
  else do
    say "Problem creating the dialog.  Init code:" dlg~initCode
    return 99
  end

  say "The user's choosen profession is" dlgData.IDC_LB
  return 0
-- End of entry point.

::requires "OODWIN32.CLS"

::class SimpleLB subclass RcDialog inherit AdvancedControls

::method initDialog

  lb = self~getListBox(IDC_LB)

  lb~add("Business Manager" )
  lb~add("Software Developer")
  lb~add("Accountant")
  lb~add("Lawyer")
  lb~add("Doctor")
]]>
</programlisting>
<para>To try the example, cut and paste the above code into a file named
<computeroutput>listBox.rex</computeroutput> and paste the following code into
files <computeroutput>listBox.rc</computeroutput> and
<computeroutput>resource.h</computeroutput>.</para>
<programlisting>
<![CDATA[
/* listBox.rc */
#include <windows.h>
#include <commctrl.h>
#include "resource.h"

IDD_DIALOG1 DIALOGEX 30,30,179,182
STYLE DS_MODALFRAME | DS_FIXEDSYS | WS_VISIBLE | WS_CAPTION | WS_POPUP | WS_SYSMENU
CAPTION "List Box Example"
FONT 8,"MS Shell Dlg 2",400,0,1
BEGIN
    DEFPUSHBUTTON   "Close",IDOK,122,161,50,14
    LISTBOX         IDC_LB,8,28,163,122,WS_TABSTOP | LBS_NOINTEGRALHEIGHT | LBS_SORT
    CTEXT           "Pick Your Choosen Profession",IDC_STATIC,26,13,122,9
END

/* resource.h */
#ifndef IDC_STATIC
#define IDC_STATIC (-1)
#endif

#define IDD_DIALOG1                     100
#define IDC_LB                          1001

]]>
</programlisting>
</listitem></varlistentry>
</variablelist>
</section>
</section>
</chapter>
