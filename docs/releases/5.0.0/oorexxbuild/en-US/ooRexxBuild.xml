<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "ooRexxBuild.ent">
%BOOK_ENTITIES;
]>
<!--#########################################################################
    #
    # Description: Open Object Rexx: Build Machine Document XML File
    #
    # Copyright (c) 2005-2022, Rexx Language Association. All rights reserved.
    # Portions Copyright (c) 2004, IBM Corporation. All rights reserved.
    #
    # This program and the accompanying materials are made available under
    # the terms of the Common Public License v1.0 which accompanies this
    # distribution. A copy is also available at the following address:
    # http://www.oorexx.org/license.html
    #
    # Redistribution and use in source and binary forms, with or
    # without modification, are permitted provided that the following
    # conditions are met:
    #
    # Redistributions of source code must retain the above copyright
    # notice, this list of conditions and the following disclaimer.
    # Redistributions in binary form must reproduce the above copyright
    # notice, this list of conditions and the following disclaimer in
    # the documentation and/or other materials provided with the distribution.
    #
    # Neither the name of Rexx Language Association nor the names
    # of its contributors may be used to endorse or promote products
    # derived from this software without specific prior written permission.
    #
    # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    # "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    # LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
    # FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    # OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    # SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    # TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    # OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
    # OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    # NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
    # SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    #
    #########################################################################
-->
<book>
	<xi:include href="Book_Info.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
	<xi:include href="Preface.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />

<chapter><title>WORK IN PROGRESS FAR FROM READY</title>
</chapter>

<chapter><title>Release Build Environment Description</title>

<section><title>Requirements</title>

<para>In early 2007 the Rexx Language Association and the Open Object Rexx
Development Team determined that it was time to provide a build environment
for the Open Object Rexx (ooRexx) application. An environment was needed that
met the following requirements:
</para>

<itemizedlist>
<listitem><para>Provide Internet access so that anyone could obtain an up-to-date
build release of ooRexx.
</para></listitem>
<listitem><para>Provide a variety of software build environments for multiple
operating systems.
</para></listitem>
<listitem><para>Provide an automated solution for each supported build
environment so that a minimum of human interaction is needed to perform a
build of ooRexx.
</para></listitem>
<listitem><para>Make all builds available to the Internet. Only keep 30 days
of builds available.
</para></listitem>
<listitem><para>Support the Subversion (SVN) source repositories.
</para></listitem>
</itemizedlist>
</section>

<section><title>Solution</title>

<para>From these requirements a plan was established to implement them. Several
decisions were made early on that influenced the final design.
</para>

<itemizedlist>
<listitem><para>Rather than purchasing individual servers for each operating
system to be supported it was determined that a better solution would be to
purchase one large server and use the Linux kernel Virtual Machine (KVM)
environment to provide support for multiple operating systems.
</para></listitem>
<listitem><para>Since the ooRexx Project is an open source project it was
determined anyone should be able to get access to a build.
</para></listitem>
<listitem><para>It was determined that we should use Fedora Linux to host the
KVM environment. This would ease security concerns and provide the easiest setup.
</para></listitem>
</itemizedlist>
</section>

<section><title>Update 2018-2022</title>

<para>After having been hosted in a cloud solution for some time, with some
performance problems, it was decided to try to migrate Jenkins to a system more
in line with the solution initially drawn up. It was agreed that the Requirements
were essentially the same as before.
</para>
</section>

<section><title>New Solution</title>

<itemizedlist>
<listitem><para>It was determined that rather than running all the software on
one single powerfull (and expensive) server, a better solution would be to
use one server as a controller, running the Jenkins webserver, and to connect
to distributed agents provided by volounteers. This is also the recommended
setup for Jenkins, since running agent tasks on the controller is deprecated for
safety reasons. This also requires only a moderatly powerful server and the
build system is easily scalable. Initially one server and three agents were
donated to the project (Windows, macOS and Raspberry Linux agents) and further
remote agents were contributed.
</para></listitem>
<listitem><para>During 2021 and 2022 it was once again experimented with
virtualisation, this time using Virtualbox running on a machine separated from
the Jenkins controller.
</para></listitem>
<listitem><para>The server used as Controller was set up using Ubuntu, whereas
the machine hosting Virtualbox was a macOS machine. Since macOS can only be
installed in a VM running on true Apple hardware, this provided the additional
advantage that all kinds of platforms could be set up in virtual machines
(Windows, macOS, Linux, Unix)
</para></listitem>
</itemizedlist>
</section>
</chapter>

<chapter><title>Build Machine (Controller) Functional Description</title>

<para>The following is the server hardware configuration to support the
ooRexx build environment:
</para>

<simplelist>
<member>Dell T20 server
</member>
<member>Quad Core Intel<trademark class="registered"></trademark>
Xeon<trademark class="registered"></trademark> 3.2 GHz CPU
</member>
<member>12GiB DDR3
</member>
<member>System disk: Crucial BX500 240 GB 3D NAND SATA 2,5-Zoll SSD
</member>
<member>Data disk: 1 TB TOSHIBA DT01ACA100 (MS2OA7S0)
</member>
<member>Backup disk: WDC Western Digital WD5000AAVS-00ZTB0 (01.01B01)
</member>
<member>CDROM/DVD R/W
</member>
</simplelist>

<para>The following operating system and ooRexx is currently installed on the
Controller (2022-07-01):
</para>

<itemizedlist>
<listitem><para>Ubuntu 20.04 LTS
</para></listitem>
<listitem><para>ooRexx version 5.0.0
</para></listitem>
</itemizedlist>

<section><title>Build Host User Accounts</title>

<para>After Ubuntu was installed on the Controller one user account was
established to own everything concerning the build process and administration of
the server. The account name was <emphasis role="italic">jenkins</emphasis>.
This account is very important because it will own the shared files for
the guest operating systems.
</para>

<para>A <emphasis role="italic">jenkins</emphasis> account is used on all
physical machines, whereas a <emphasis role="italic">osboxes</emphasis> account
is used on all virtual machines. More about this later.
</para>
</section>

<section><title>Disk Layout</title>

<para>CONTINUE HERE After considering a number of different partitioning schemes for the build
server it was determined that the best alternative would be to keep the
partitioning scheme as simple as possible and still provide for upgrades to
the host system. The following scheme was applied to the server disk.
</para>

<itemizedlist>
<listitem><para>100MB partition for /boot
</para></listitem>
<listitem><para>50GB partition for / root partition
</para></listitem>
<listitem><para>100GB partition for /home partition
</para></listitem>
<listitem><para>1000GB partition for /pub partition
</para></listitem>
<listitem><para>500GB partition for /virt partition
</para></listitem>
<listitem><para>16GB swap partition
</para></listitem>
</itemizedlist>

</section>

<section><title>Operating System Installation</title>

<para>The following are the step-by-step instructions used for setting up the
build machine environment. This does not include instructions on setting up
VMware guest operating systems. Those instructions are described in the sections
describing each individual guest OS.
</para>

<para>Hopefully you have installed the Fedora Linux distribution before so
an extended step-by-step guide will not be needed. Only the essential steps
are described below as well as the configuration steps for managing the
server.
</para>

<orderedlist>
    <listitem><para>Start the Fedora installation.
    </para></listitem>
    <listitem><para>Partition the hard drive per the description above.
    </para></listitem>
    <listitem><para>SELinux was disabled for our installation as that level of
    security was not deemed necessary.
    </para></listitem>
    <listitem><para>The firewall was enabled for our installation because the
    server is directly available on the Internet.
    </para></listitem>
    <listitem><para>Make sure that you install Apache, all the development tools,
    CVS, Subversion, Samba (used by the Windows guest OSs), xinetd,
    and any other required tools.
    </para></listitem>
    <listitem><para>After the reboot, create the
    <emphasis role="italic">buildorx</emphasis> user account.
    </para></listitem>
    <listitem><para>On the initial login let the software updates be applied
    to the system when prompted by the system.
    <note><para>This will probably load a new Linux kernel onto the system.
    </para></note>
    </para></listitem>
    <listitem><para>Naturally we will install a copy of Open Object Rexx. It will
    be used as our primary scripting engine. The latest version at the time of this
    publication was 4.1.
    </para></listitem>
    <listitem><para>Samba is used to store shared files used by the WMware Windows
    guest operating systems. To set it up first edit the
    <varname>/etc/samba/smb.conf</varname> and make the following changes.
    <programlisting>
    # Use whatever workgroup works for you but remember that all the guest
    # Windows OSs must use the same value.
       workgroup = OOREXX

    # This should cover any virtual network defined by VMware
    # It will also restrict the shares to the vitual network
       interfaces = vmnet*

    # Create the public share with exclusive access given to the buildox account
    [public]
       comment = Shared public stuff
       path = /pub
       public = yes
       writable = yes
       printable = no
       write list = @users
       force group = @users
       create mask = 0664
       directory mask = 0775
    </programlisting>
    </para>
    <para>Next we need to create the SMB user account that will be used by the
    guest Windows OS clients.
    <programlisting>
    # smbpasswd -a buildorx
    </programlisting>
    </para>
    <para>Now start the Samba server and make it auto start at boot.
    <programlisting>
    # service smb start
    # chkconfig --level 5 smb on
    </programlisting>
    </para>
    </listitem>
    <listitem><para>Next we need to generate the SSH public/private keys for the
    server.</para>
    <programlisting>
    # ssh-keygen
    </programlisting>
    <para>Be sure to just hit return for the passphrase prompt (we do NOT want
    a passphrase). Otherwise we cannot get true automation from our scripts.
    </para>
    </listitem>
</orderedlist>
</section>

</chapter>


<xi:include href="kvm.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="guestos.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="admin.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="releases.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="Common_Content/Notices.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="Common_Content/CPLv1.0.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<xi:include href="Revision_History.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
<index />

</book>
